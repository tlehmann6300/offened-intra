const SKELETON_LOADER_DELAY=500,INVENTORY_BACK_TO_TOP_THRESHOLD=500,FADE_ANIMATION_DURATION=300,BANNER_ANIMATION_DELAY=10,COOKIE_BANNER_HIDE_DELAY=400,COOKIE_BANNER_SHOW_DELAY=1500,AOS_INIT_TIMEOUT=2e3,API_BASE_URL=window.ibcConfig?.apiUrl??window.appConfig?.baseUrl??"",BASE_URL=window.ibcConfig?.baseUrl??window.appConfig?.baseUrl??"";function buildApiUrl(e){if(!e||"string"!=typeof e)return API_BASE_URL||"";const t=e.startsWith("/")?e.substring(1):e;return API_BASE_URL?`${API_BASE_URL}/${t}`:t}const FLAG_URLS={de:"assets/img/flags/de.svg",en:"assets/img/flags/gb.svg",fr:"assets/img/flags/fr.svg"},FLAG_ALT_TEXTS={de:"Deutsche Flagge",en:"Britische Flagge",fr:"Französische Flagge"};function getStorageItem(e){try{return localStorage.getItem(e)}catch(t){try{return sessionStorage.getItem(e)}catch(e){return null}}}function setStorageItem(e,t){try{return localStorage.setItem(e,t),!0}catch(n){try{return sessionStorage.setItem(e,t),!0}catch(e){return!1}}}function getCsrfToken(){const e=document.querySelector('meta[name="csrf-token"]');if(e){const t=e.getAttribute("content");if(t&&t.trim().length>0)return t.trim()}if(window.ibcConfig&&window.ibcConfig.csrfToken){const e=window.ibcConfig.csrfToken;if(e&&e.trim().length>0)return e.trim()}return console.warn("CSRF token not found. POST requests may fail."),null}function addCsrfHeader(e={}){const t=getCsrfToken();return t?e["X-CSRF-Token"]=t:console.error("CRITICAL: CSRF token is missing. Request may be rejected by server."),e}function toggleButtonState(e,t){if(e)if(t){if(e.dataset.originalContent||(e.dataset.originalContent=e.innerHTML),e.disabled=!0,!e.querySelector(".spinner-border")){const t=document.createElement("span");t.className="spinner-border spinner-border-sm me-2",t.setAttribute("role","status"),t.setAttribute("aria-hidden","true"),e.insertBefore(t,e.firstChild)}}else{if(e.dataset.originalContent)e.innerHTML=e.dataset.originalContent,delete e.dataset.originalContent;else{const t=e.querySelector(".spinner-border");t&&t.remove()}e.disabled=!1}}function toggleButtonLoading(e,t){toggleButtonState(e,t)}function toggleButton(e,t){toggleButtonState(e,t)}function initGlobalImageErrorHandler(){const e="ibcGrad1-"+Math.random().toString(36).substring(2,11),t="ibcGrad2-"+Math.random().toString(36).substring(2,11),n="avatarGrad-"+Math.random().toString(36).substring(2,11),a="data:image/svg+xml;base64,"+btoa(`\n        <svg width="400" height="400" xmlns="http://www.w3.org/2000/svg">\n            <defs>\n                <linearGradient id="${e}" x1="0%" y1="0%" x2="100%" y2="100%">\n                    <stop offset="0%" style="stop-color:#20234A;stop-opacity:1" />\n                    <stop offset="100%" style="stop-color:#6D9744;stop-opacity:1" />\n                </linearGradient>\n                <linearGradient id="${t}" x1="0%" y1="0%" x2="0%" y2="100%">\n                    <stop offset="0%" style="stop-color:#6D9744;stop-opacity:1" />\n                    <stop offset="100%" style="stop-color:#4A7129;stop-opacity:1" />\n                </linearGradient>\n            </defs>\n            \x3c!-- Background --\x3e\n            <rect width="400" height="400" fill="url(#${e})" rx="20"/>\n            \n            \x3c!-- IBC Logo representation --\x3e\n            <g transform="translate(200, 200)">\n                \x3c!-- Circle background for logo --\x3e\n                <circle cx="0" cy="0" r="80" fill="white" opacity="0.95"/>\n                \n                \x3c!-- Stylized IBC letters --\x3e\n                <text x="0" y="0" text-anchor="middle" dominant-baseline="central" \n                      style="font-family: 'Arial', sans-serif; font-weight: bold; font-size: 48px; fill: #20234A;">IBC</text>\n                \n                \x3c!-- Decorative elements --\x3e\n                <circle cx="0" cy="0" r="85" fill="none" stroke="white" stroke-width="3" opacity="0.8"/>\n                <circle cx="0" cy="0" r="92" fill="none" stroke="white" stroke-width="2" opacity="0.5"/>\n            </g>\n            \n            \x3c!-- Bottom text --\x3e\n            <text x="200" y="330" text-anchor="middle" \n                  style="font-family: 'Arial', sans-serif; font-size: 18px; fill: white; opacity: 0.9;">\n                Bild nicht verfügbar\n            </text>\n        </svg>\n    `.trim()),o="data:image/svg+xml;base64,"+btoa(`\n        <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">\n            <defs>\n                <linearGradient id="${n}" x1="0%" y1="0%" x2="100%" y2="100%">\n                    <stop offset="0%" style="stop-color:#20234A;stop-opacity:1" />\n                    <stop offset="100%" style="stop-color:#6D9744;stop-opacity:1" />\n                </linearGradient>\n            </defs>\n            <rect width="200" height="200" fill="url(#${n})" rx="100"/>\n            <g transform="translate(100, 100)">\n                <circle cx="0" cy="-20" r="30" fill="white" opacity="0.9"/>\n                <ellipse cx="0" cy="50" rx="50" ry="40" fill="white" opacity="0.9"/>\n            </g>\n        </svg>\n    `.trim());document.querySelectorAll("img").forEach(e=>{e.dataset.errorHandled||(e.addEventListener("error",function(){s(this)},{once:!0}),e.dataset.errorHandled="true")});function s(e){if(e.dataset.placeholderApplied)return;e.dataset.placeholderApplied="true";e.classList.contains("profile-picture")||e.classList.contains("avatar")||e.closest(".profile-picture-preview")||e.alt?.toLowerCase().includes("profile")||e.alt?.toLowerCase().includes("avatar")?(e.src=o,e.alt="Platzhalter-Avatar"):(e.src=a,e.alt="Bild nicht verfügbar"),e.style.opacity="0.85"}new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{1===e.nodeType&&("IMG"!==e.tagName||e.dataset.errorHandled||(e.addEventListener("error",function(){s(this)},{once:!0}),e.dataset.errorHandled="true"),e.querySelectorAll&&e.querySelectorAll("img").forEach(e=>{e.dataset.errorHandled||(e.addEventListener("error",function(){s(this)},{once:!0}),e.dataset.errorHandled="true")}))})})}).observe(document.body,{childList:!0,subtree:!0})}function acceptCookies(){setStorageItem("cookie_consent","true")||setStorageItem("cookie_banner_shown","true");const e=document.getElementById("cookie-banner");e&&(e.classList.add("hide"),setTimeout(()=>{e.style.display="none"},400))}function declineCookies(){setStorageItem("cookie_consent","false")||setStorageItem("cookie_banner_shown","false");const e=document.getElementById("cookie-banner");e&&(e.classList.add("hide"),setTimeout(()=>{e.style.display="none"},400))}function reopenCookieBanner(){const e=document.getElementById("cookie-banner");e&&(e.style.display="block",e.classList.remove("hide"),setTimeout(()=>{e.classList.add("show")},10))}function initializeAOSWhenReady(){if("undefined"==typeof AOS)return void console.warn("AOS library not loaded - animations will not be available");const e=[document.getElementById("newsGrid"),document.getElementById("inventoryContainer"),document.querySelector(".container"),document.querySelector("main")].filter(e=>null!==e);if(0===e.length)return void AOS.init({duration:800,easing:"ease-out-cubic",once:!0,offset:100});const t=[];e.forEach(e=>{e.querySelectorAll("img").forEach(e=>{e.complete||t.push(e)})});const n=()=>{AOS.init({duration:800,easing:"ease-out-cubic",once:!0,offset:100,disable:!1})};if(0===t.length)return void requestAnimationFrame(()=>{requestAnimationFrame(n)});let a=0;const o=t.length,s=setTimeout(()=>{n()},2e3),i=()=>{a++,a>=o&&(clearTimeout(s),requestAnimationFrame(()=>{requestAnimationFrame(n)}))};t.forEach(e=>{e.complete?i():(e.addEventListener("load",i),e.addEventListener("error",i))})}function addFadeInAnimation(){document.querySelectorAll(".card").forEach((e,t)=>{setTimeout(()=>{e.classList.add("fade-in")},50*t)}),initScrollAnimations()}function initScrollAnimations(){if(!("IntersectionObserver"in window))return void document.querySelectorAll(".fade-in-up, .animate-on-scroll").forEach(e=>{e.classList.add("is-visible")});const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("is-visible"),e.unobserve(t.target))})},{root:null,rootMargin:"0px 0px -100px 0px",threshold:.1});document.querySelectorAll(".fade-in-up, .animate-on-scroll, .reveal-fx, section, .service-card, .info-card").forEach(t=>{e.observe(t)})}function initFormValidation(){const e=document.querySelectorAll(".needs-validation");Array.from(e).forEach(e=>{e.addEventListener("submit",t=>{e.checkValidity()||(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")},!1)})}function autoHideAlerts(){document.querySelectorAll(".alert:not(.alert-permanent)").forEach(e=>{setTimeout(()=>{new bootstrap.Alert(e).close()},5e3)})}function previewImage(e,t){if(e.files&&e.files[0]){const n=new FileReader;n.onload=function(e){const n=document.getElementById(t);n&&(n.src=e.target.result,n.style.display="block")},n.readAsDataURL(e.files[0])}}function confirmDelete(e){return confirm(e||"Sind Sie sicher, dass Sie diesen Eintrag löschen möchten?")}function copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>{showToast("In Zwischenablage kopiert!","success")}).catch(()=>{showToast("Fehler beim Kopieren","danger")})}function showToast(e,t="info"){let n=document.getElementById("toastContainer");n||(n=document.createElement("div"),n.id="toastContainer",n.className="toast-container position-fixed top-0 end-0 p-3",n.style.zIndex="9999",document.body.appendChild(n));const a="toast-"+Date.now(),o=`\n        <div id="${a}" class="toast align-items-center text-white bg-${t} border-0" role="alert" aria-live="assertive" aria-atomic="true">\n            <div class="d-flex">\n                <div class="toast-body">\n                    ${e}\n                </div>\n                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n            </div>\n        </div>\n    `;n.insertAdjacentHTML("beforeend",o);const s=document.getElementById(a);new bootstrap.Toast(s,{delay:3e3}).show(),s.addEventListener("hidden.bs.toast",function(){s.remove()})}function debounce(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...a)},t)}}function formatDate(e){return new Date(e).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric"})}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}function initializeLanguageFlag(){for(var e=document.cookie.split(";"),t="",n=0;n<e.length;n++){var a=e[n].trim();if(a.startsWith("language=")){t=a.split("=")[1];break}}if(!t){var o=localStorage.getItem("language");o&&["de","en","fr"].includes(o)&&(t=o)}t||(t="de");var s=document.getElementById("activeFlag");s&&FLAG_URLS[t]&&(s.src=FLAG_URLS[t],s.alt=FLAG_ALT_TEXTS[t]),document.querySelectorAll(".lang-item").forEach(function(e){e.getAttribute("data-lang")===t?e.setAttribute("aria-current","true"):e.removeAttribute("aria-current")})}function initializeEmailCopy(){document.querySelectorAll(".copy-email-link").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var t=this.textContent.trim();if(this.classList.contains("email-icon-link")){var n=this.closest(".email-cta");if(n){var a=n.querySelector(".copy-email-link:not(.email-icon-link)");a&&(t=a.textContent.trim())}}t&&t.includes("@")&&copyToClipboard(t)})})}function removeSkeletonLoaders(){setTimeout(()=>{document.querySelectorAll(".skeleton").forEach(e=>{e.classList.remove("skeleton"),e.style.opacity="1"})},500)}function initLogoErrorHandling(){const e=document.getElementById("navbar-logo"),t=document.getElementById("navbar-fallback-text");e&&t&&e.addEventListener("error",function(){e.style.display="none",t.style.display="inline"})}function selectRole(e){const t=document.getElementById("loadingOverlay");t&&t.classList.add("active"),fetch(buildApiUrl("index.php?page=select_role"),{method:"POST",headers:addCsrfHeader({"Content-Type":"application/x-www-form-urlencoded"}),body:"action=select_role&role="+encodeURIComponent(e)}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{e.success?window.location.href="index.php?page=home":(showToast("Fehler: "+(e.message||"Rolle konnte nicht gesetzt werden."),"danger"),t&&t.classList.remove("active"))}).catch(e=>{console.error("Error selecting role:",e),showToast("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.","danger"),t&&t.classList.remove("active")})}function applyToProject(e){showToast('Bewerbung für Projekt "'+e+'" wird eingereicht.\n\nIn der finalen Version würde hier ein Formular zur Projektbewerbung erscheinen.',"info")}function initNotificationBell(){const e=document.getElementById("notificationBell"),t=document.getElementById("notificationPanel"),n=document.getElementById("notificationContent"),a=document.getElementById("notificationBadge");if(!e||!t||!n)return;let o=!1;function s(){t.style.display="none",o=!1}function i(e){n.innerHTML=`\n            <div class="text-center py-4 px-3">\n                <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>\n                <p class="text-danger">${e}</p>\n            </div>\n        `}e.addEventListener("click",function(e){e.stopPropagation(),o?s():(t.style.display="block",o=!0,n.innerHTML='\n            <div class="text-center py-4">\n                <div class="spinner-border text-primary" role="status">\n                    <span class="visually-hidden">Wird geladen...</span>\n                </div>\n            </div>\n        ',fetch(buildApiUrl("api/notification_api.php"),{method:"POST",headers:addCsrfHeader({"Content-Type":"application/x-www-form-urlencoded"}),body:"action=get_helper_requests"}).then(e=>e.json()).then(e=>{e.success?function(e){if(!e||0===e.length)return void(n.innerHTML='\n                <div class="text-center py-4 px-3">\n                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>\n                    <p class="text-muted">Keine neuen Helfer-Gesuche vorhanden</p>\n                </div>\n            ');let t='<div class="list-group list-group-flush">';e.forEach(e=>{const n=new Date(e.event_date).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric"}),a=new Date(e.start_time).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}),o=new Date(e.end_time).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"});t+=`\n                <a href="index.php?page=events#event-${e.event_id}" class="list-group-item list-group-item-action">\n                    <div class="d-flex w-100 justify-content-between align-items-start">\n                        <div class="flex-grow-1">\n                            <h6 class="mb-1 fw-bold">${escapeHtml(e.event_title)}</h6>\n                            <p class="mb-1 small">\n                                <i class="fas fa-tasks me-1 text-primary"></i>\n                                <strong>${escapeHtml(e.task_name)}</strong>\n                            </p>\n                            <p class="mb-1 small text-muted">\n                                <i class="fas fa-calendar me-1"></i>${n}\n                            </p>\n                            <p class="mb-0 small text-muted">\n                                <i class="fas fa-clock me-1"></i>${a} - ${o}\n                            </p>\n                        </div>\n                        <div class="text-end ms-3">\n                            <span class="badge bg-success">\n                                ${e.slots_available} ${1===e.slots_available?"Platz":"Plätze"}\n                            </span>\n                        </div>\n                    </div>\n                </a>\n            `}),t+="</div>",t+='\n            <div class="card-footer text-center">\n                <a href="index.php?page=events" class="text-decoration-none">\n                    Alle Events anzeigen <i class="fas fa-arrow-right ms-1"></i>\n                </a>\n            </div>\n        ',n.innerHTML=t}(e.requests):i("Fehler beim Laden der Helfer-Gesuche")}).catch(e=>{console.error("Error loading helper requests:",e),i("Verbindungsfehler")}),a&&fetch(buildApiUrl("api/clear_notifications.php"),{method:"POST",headers:addCsrfHeader({"Content-Type":"application/x-www-form-urlencoded"})}).then(e=>e.json()).then(e=>{e.success&&a&&(a.style.display="none")}).catch(e=>{console.error("Error marking notifications as read:",e)}))}),document.addEventListener("click",function(n){!o||e.contains(n.target)||t.contains(n.target)||s()})}function initQuickAddLocation(){const e=document.getElementById("quickAddLocationBtn"),t=document.getElementById("quickAddLocationInput"),n=document.getElementById("itemLocation");e&&t&&n&&(e.addEventListener("click",async function(){const a=t.value.trim();if(!a)return void showToast("Bitte geben Sie einen Standort-Namen ein","warning");const o=document.querySelector("[data-csrf-token]")?.getAttribute("data-csrf-token");if(o){toggleButtonLoading(e,!0);try{const e=new FormData;e.append("action","add_location"),e.append("location_name",a),e.append("csrf_token",o);const s=await fetch(buildApiUrl("index.php?page=inventory"),{method:"POST",headers:addCsrfHeader({}),body:e}),i=await s.json();if(i.success){if(showToast(i.message||"Standort erfolgreich hinzugefügt","success"),t.value="",i.location){const e=document.createElement("option");if(e.value=i.location,e.textContent=i.location,e.selected=!0,n.add(e),i.locations&&Array.isArray(i.locations)){for(;n.options.length>1;)n.remove(1);i.locations.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,e===i.location&&(t.selected=!0),n.add(t)})}}}else showToast(i.message||"Fehler beim Hinzufügen des Standorts","danger")}catch(e){console.error("Error adding location:",e),showToast("Fehler beim Hinzufügen des Standorts","danger")}finally{toggleButtonLoading(e,!1)}}else showToast("CSRF-Token fehlt. Bitte laden Sie die Seite neu.","danger")}),t.addEventListener("keypress",function(t){"Enter"===t.key&&(t.preventDefault(),e.click())}))}function initInventoryImagePreview(){const e=document.getElementById("itemImage");e&&e.addEventListener("change",function(e){const t=e.target.files[0];if(t){const e=document.getElementById("uploadProgress"),n=document.getElementById("uploadProgressBar"),a=document.getElementById("uploadProgressText"),o=document.getElementById("imagePreview");if(e&&n&&a&&o){o.style.display="none",e.style.display="block",n.style.width="0%",n.setAttribute("aria-valuenow","0"),a.textContent="0%";const s=new FileReader;s.onprogress=function(e){if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);n.style.width=t+"%",n.setAttribute("aria-valuenow",t),a.textContent=t+"%"}},s.onload=function(t){n.style.width="100%",n.setAttribute("aria-valuenow","100"),a.textContent="100%",setTimeout(()=>{e.style.display="none";const n=document.getElementById("previewImg");n&&o&&(n.src=t.target.result,o.style.display="block")},300)},s.onerror=function(){e.style.display="none",showToast("Fehler beim Laden der Vorschau","danger")},s.readAsDataURL(t)}}else{const e=document.getElementById("imagePreview"),t=document.getElementById("uploadProgress");e&&(e.style.display="none"),t&&(t.style.display="none")}})}window.secureFetch=function(e,t={}){const n={...t},a=n.button,o=n.skipErrorToast||!1;delete n.button,delete n.skipErrorToast;const s=(n.method||"GET").toUpperCase();return["POST","PUT","PATCH","DELETE"].includes(s)&&(n.headers=addCsrfHeader(n.headers||{})),a&&toggleButtonState(a,!0),fetch(e,n).then(e=>(a&&toggleButtonState(a,!1),e.ok?e.json().then(e=>{if(e&&"boolean"==typeof e.success&&!e.success){const t=e.message||"Ein Fehler ist aufgetreten.";o||showToast(t,"danger")}return e}).catch(t=>e):e.json().then(t=>{const n=t.message||`Server error: ${e.status} ${e.statusText}`;return o||showToast(n,"danger"),Promise.reject({response:e,data:t})}).catch(t=>{const n=`Server error: ${e.status} ${e.statusText}`;return o||showToast(n,"danger"),Promise.reject({response:e,data:{message:n}})}))).catch(e=>{if(a&&toggleButtonState(a,!1),e.response)throw e;throw o||showToast("Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.","danger"),e})},function(){const e=window.fetch;window.fetch=function(t,n={}){let a=!1;try{if(t.startsWith("http://")||t.startsWith("https://")){a=new URL(t,window.location.origin).origin===window.location.origin}else a=!0}catch(e){a=!0}if(a){const e=(n.method||"GET").toUpperCase();["POST","PUT","PATCH","DELETE"].includes(e)&&(n.headers=addCsrfHeader(n.headers||{}))}return e(t,n)}}(),window.addEventListener("scroll",function(){const e=document.getElementById("scrollTopBtn");if(window.pageYOffset>300){if(!e){const e=document.createElement("button");e.id="scrollTopBtn",e.className="btn btn-primary position-fixed bottom-0 end-0 m-3",e.style.zIndex="1000",e.innerHTML='<i class="bi bi-arrow-up"></i>',e.onclick=scrollToTop,document.body.appendChild(e)}}else e&&e.remove()}),function(){let e=0;const t=document.querySelector(".navbar");t&&window.addEventListener("scroll",()=>{const n=window.pageYOffset;n>100?t.classList.add("scrolled"):t.classList.remove("scrolled"),e=n})}(),document.addEventListener("DOMContentLoaded",function(){"true"===getStorageItem("high_contrast_mode")&&document.body.classList.add("high-contrast-mode");const e=document.getElementById("cookie-banner");if(e){getStorageItem("cookie_consent")||getStorageItem("cookie_banner_shown")||setTimeout(()=>{e.classList.add("show")},1500);const t=document.getElementById("cookie-accept-btn");t&&t.addEventListener("click",acceptCookies);const n=document.getElementById("cookie-decline-btn");n&&n.addEventListener("click",declineCookies);const a=document.querySelector(".cookie-settings-link");a&&a.addEventListener("click",function(e){e.preventDefault(),reopenCookieBanner()})}document.getElementById("newsChart")&&void 0!==window.newsChartData&&initNewsChart(),addFadeInAnimation(),initFormValidation(),autoHideAlerts(),initializeLanguageFlag(),initializeEmailCopy(),initScrollAnimations(),removeSkeletonLoaders(),initLogoErrorHandling(),initGlobalImageErrorHandler(),document.getElementById("inventoryForm")&&initInventoryManagement(),initButtonLoadingSpinners(),initNotificationBell(),initializeAOSWhenReady(),initEventCountdown()});let currentFilters={search:"",category:"all",location:"all",status:"all"};function hasActiveFilters(){return!(!currentFilters.search&&"all"===currentFilters.category&&"all"===currentFilters.location&&"all"===currentFilters.status)}function resetFilters(){currentFilters={search:"",category:"all",location:"all",status:"all"};const e=document.getElementById("liveSearchInput");e&&(e.value="");document.querySelectorAll(".filter-pill").forEach(e=>{"all"===e.getAttribute("data-value")?e.classList.add("active"):e.classList.remove("active")}),performSearch()}function initPerfectSearch(){const e=document.getElementById("liveSearchInput");if(!e)return;const t=debounce(()=>{performSearch()},300);e.addEventListener("input",function(e){currentFilters.search=e.target.value,t()})}function applyFilter(e,t,n){const a=n.closest(".filter-pills");if(a){a.querySelectorAll(".filter-pill").forEach(e=>e.classList.remove("active")),n.classList.add("active")}currentFilters[e]=t,performSearch()}function getErrorStateTemplate(){return'\n        <div class="col-12">\n            <div class="card glass-card text-center py-5 px-4 border-danger" style="max-width: 600px; margin: 0 auto;">\n                <div class="card-body">\n                    <div class="error-state-icon mb-4">\n                        <i class="fas fa-exclamation-triangle fa-5x text-danger" style="opacity: 0.5;"></i>\n                    </div>\n                    <h3 class="mb-3 text-danger">Fehler beim Laden</h3>\n                    <p class="text-muted mb-4">\n                        Es ist ein Fehler beim Laden der Inventardaten aufgetreten. \n                        Bitte überprüfen Sie Ihre Internetverbindung und versuchen Sie es erneut.\n                    </p>\n                    <button type="button" class="btn btn-danger btn-lg" id="retrySearchBtn">\n                        <i class="fas fa-sync-alt me-2"></i>Erneut versuchen\n                    </button>\n                </div>\n            </div>\n        </div>\n    '}function getEmptyStateTemplate(e){return`\n        <div class="col-12">\n            <div class="card glass-card text-center py-5 px-4" style="max-width: 600px; margin: 0 auto;">\n                <div class="card-body">\n                    <div class="empty-state-icon mb-4">\n                        <i class="fas fa-box-open fa-5x text-primary" style="opacity: 0.3;"></i>\n                    </div>\n                    <h3 class="mb-3">Keine Gegenstände gefunden</h3>\n                    ${e?'\n                        <p class="text-muted mb-4">\n                            Ihre Suche oder Filter ergab keine Treffer. \n                            Versuchen Sie andere Suchbegriffe oder setzen Sie die Filter zurück.\n                        </p>\n                        <button type="button" class="btn btn-primary btn-lg" id="resetFiltersBtn">\n                            <i class="fas fa-redo me-2"></i>Filter zurücksetzen\n                        </button>\n                    ':'\n                        <p class="text-muted mb-4">\n                            Es sind noch keine Gegenstände im Inventar vorhanden.\n                        </p>\n                    '}\n                </div>\n            </div>\n        </div>\n    `}function performSearch(){const e=document.getElementById("inventoryContainer"),t=document.getElementById("searchSpinner");if(!e)return;t&&(t.style.display="flex"),showSkeletonLoaders(e);const n=new FormData;n.append("action","search"),n.append("search",currentFilters.search),n.append("category",currentFilters.category),n.append("location",currentFilters.location),n.append("status",currentFilters.status),fetch(buildApiUrl("index.php?page=inventory"),{method:"POST",headers:addCsrfHeader({}),body:n}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(t=>{t.success?(renderInventoryItems(t.items,e),0===t.items.length&&hasActiveFilters()&&showToast("Keine Ergebnisse gefunden. Versuchen Sie andere Suchbegriffe oder Filter.","info"),"undefined"!=typeof AOS&&AOS.refresh()):(console.error("Search error:",t.message),showToast("Fehler beim Suchen: "+(t.message||"Unbekannter Fehler"),"danger"))}).catch(t=>{if(console.error("Error performing search:",t),e){e.innerHTML=getErrorStateTemplate();const t=document.getElementById("retrySearchBtn");if(t){const e=t.cloneNode(!0);t.replaceWith(e),e.addEventListener("click",performSearch)}}showToast("Ein Fehler ist aufgetreten beim Suchen.","danger")}).finally(()=>{t&&(t.style.display="none")})}function showSkeletonLoaders(e,t=8){const n=[];for(let e=0;e<t;e++)n.push('\n            <div class="col" aria-hidden="true">\n                <div class="card glass-card inventory-card h-100">\n                    <div class="placeholder-glow">\n                        <div class="inventory-image-container">\n                            <div class="placeholder col-12 bg-secondary" style="width: 100%; height: 100%;"></div>\n                        </div>\n                    </div>\n                    <div class="card-body">\n                        <div class="placeholder-glow mb-2">\n                            <span class="placeholder col-8 bg-secondary"></span>\n                        </div>\n                        <div class="placeholder-glow mb-3">\n                            <span class="placeholder col-12 bg-secondary"></span>\n                            <span class="placeholder col-10 bg-secondary"></span>\n                        </div>\n                        <div class="placeholder-glow">\n                            <span class="placeholder col-6 bg-secondary"></span>\n                            <span class="placeholder col-5 bg-secondary"></span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ');e.innerHTML=n.join("")}function createAlumniSkeleton(e=6){const t=[];for(let n=0;n<e;n++)t.push('\n            <div class="col" aria-hidden="true">\n                <div class="card glass-card h-100">\n                    <div class="card-body p-4">\n                        \x3c!-- Profile Header with Avatar --\x3e\n                        <div class="d-flex align-items-start mb-3">\n                            \x3c!-- Avatar Placeholder --\x3e\n                            <div class="flex-shrink-0 me-3">\n                                <div class="placeholder-glow">\n                                    <div class="placeholder bg-secondary" style="width: 80px; height: 80px; border-radius: 50%;"></div>\n                                </div>\n                            </div>\n                            \n                            \x3c!-- Profile Info Placeholder --\x3e\n                            <div class="flex-grow-1">\n                                <div class="placeholder-glow mb-2">\n                                    <span class="placeholder col-8 bg-secondary"></span>\n                                </div>\n                                <div class="placeholder-glow">\n                                    <span class="placeholder col-6 bg-secondary"></span>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Position and Company Placeholder --\x3e\n                        <div class="mb-3">\n                            <div class="placeholder-glow mb-2">\n                                <span class="placeholder col-10 bg-secondary"></span>\n                            </div>\n                            <div class="placeholder-glow">\n                                <span class="placeholder col-8 bg-secondary"></span>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Bio Placeholder --\x3e\n                        <div class="mb-3">\n                            <div class="placeholder-glow">\n                                <span class="placeholder col-12 bg-secondary"></span>\n                                <span class="placeholder col-12 bg-secondary"></span>\n                                <span class="placeholder col-9 bg-secondary"></span>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Badges Placeholder --\x3e\n                        <div class="mb-3">\n                            <div class="placeholder-glow">\n                                <span class="placeholder col-4 bg-secondary" style="height: 24px; display: inline-block; border-radius: 12px; margin-right: 8px;"></span>\n                                <span class="placeholder col-4 bg-secondary" style="height: 24px; display: inline-block; border-radius: 12px;"></span>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Contact Buttons Placeholder --\x3e\n                        <div class="d-flex gap-2 pt-2 border-top">\n                            <div class="placeholder-glow flex-fill">\n                                <span class="placeholder col-12 bg-secondary" style="height: 32px; display: block; border-radius: 6px;"></span>\n                            </div>\n                            <div class="placeholder-glow flex-fill">\n                                <span class="placeholder col-12 bg-secondary" style="height: 32px; display: block; border-radius: 6px;"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ');return t.join("")}function renderInventoryItems(e,t){if(0===e.length){const e=hasActiveFilters();if(t.innerHTML=getEmptyStateTemplate(e),e){const e=document.getElementById("resetFiltersBtn");if(e){const t=e.cloneNode(!0);e.replaceWith(t),t.addEventListener("click",resetFilters)}}return}const n=null!==document.querySelector('[onclick*="openEditModal"]'),a=document.createDocumentFragment();e.forEach((e,t)=>{const o=(e.category||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[äöüß]/g,e=>({"ä":"ae","ö":"oe","ü":"ue","ß":"ss"}[e]||e)),s=parseInt(e.quantity||0),i=e.status||"active";let r="success",l="Auf Lager";0===s||"broken"===i?(r="danger",l="Nicht verfügbar"):s>=1&&s<=5&&(r="warning",l="Niedriger Bestand");const d=0===s?"out-of-stock":"",c=e.image_path?`/assets/uploads/inventory/${encodeURIComponent(e.image_path)}`:"",u=document.createElement("div");u.className="col",u.setAttribute("data-aos","fade-up"),u.setAttribute("data-aos-delay",String(t%4*100));const m=`\n            <div class="card glass-card inventory-card h-100 ${d}" \n                 data-category="${escapeHtml(o)}" \n                 data-item-id="${e.id}">\n                \x3c!-- Status Indicator --\x3e\n                <div class="status-indicator">\n                    <i class="fas fa-circle text-${r}" title="${l}"></i>\n                </div>\n                \n                \x3c!-- Image with fixed aspect ratio --\x3e\n                <div class="inventory-image-container">\n                    ${c?`<img src="${c}" class="inventory-image" alt="${escapeHtml(e.name)}" loading="lazy">`:'<div class="inventory-image-placeholder">\n                            <i class="fas fa-image fa-3x text-white-50"></i>\n                        </div>'}\n                    \n                    ${n?`\n                        <div class="inventory-actions">\n                            <button type="button" class="btn btn-sm btn-light me-2" \n                                    data-action="edit-inventory"\n                                    data-item-id="${e.id}"\n                                    title="Bearbeiten">\n                                <i class="fas fa-edit"></i>\n                            </button>\n                            <button type="button" class="btn btn-sm btn-danger" \n                                    data-action="delete-inventory"\n                                    data-item-id="${e.id}"\n                                    title="Löschen">\n                                <i class="fas fa-trash"></i>\n                            </button>\n                        </div>\n                    `:""}\n                    \n                    \x3c!-- Quantity Badge - floating on top right --\x3e\n                    ${0===s?'<span class="badge bg-danger inventory-badge">Nicht verfügbar</span>':`<span class="badge bg-success inventory-badge">${s}x</span>`}\n                </div>\n                \n                \x3c!-- Card Body --\x3e\n                <div class="card-body">\n                    <h5 class="card-title fw-bold">${escapeHtml(e.name)}</h5>\n                    \n                    ${e.description?`<p class="card-text text-muted small">${escapeHtml(e.description)}</p>`:""}\n                    \n                    ${n?`\n                        <div class="mobile-quantity-controls d-lg-none mt-3 mb-3">\n                            <div class="d-flex align-items-center justify-content-center gap-3">\n                                <button type="button" \n                                        class="btn btn-lg btn-outline-danger quantity-btn" \n                                        onclick="adjustQuantity(${e.id}, -1, this)"\n                                        title="Menge verringern"\n                                        ${s<=0?"disabled":""}>\n                                    <i class="fas fa-minus"></i>\n                                </button>\n                                <span class="quantity-display fs-4 fw-bold" data-item-id="${e.id}">\n                                    ${s}\n                                </span>\n                                <button type="button" \n                                        class="btn btn-lg btn-outline-success quantity-btn" \n                                        onclick="adjustQuantity(${e.id}, 1, this)"\n                                        title="Menge erhöhen">\n                                    <i class="fas fa-plus"></i>\n                                </button>\n                            </div>\n                        </div>\n                    `:""}\n                    \n                    <div class="mt-3">\n                        ${e.location?`<span class="badge bg-primary me-2">\n                                <i class="fas fa-map-marker-alt me-1"></i>${escapeHtml(e.location)}\n                            </span>`:""}\n                        \n                        ${e.category?`<span class="badge bg-info">\n                                <i class="fas fa-tag me-1"></i>${escapeHtml(e.category)}\n                            </span>`:""}\n                    </div>\n                </div>\n            </div>\n        `;u.innerHTML=m,a.appendChild(u)}),t.innerHTML="",t.appendChild(a)}function escapeHtml(e){if(null==e)return"";"string"!=typeof e&&(e=String(e));const t=document.createElement("div");return t.textContent=e,t.innerHTML}function openCreateModal(){const e=document.getElementById("inventoryModalLabel"),t=document.getElementById("formAction"),n=document.getElementById("submitBtnText"),a=document.getElementById("inventoryForm"),o=document.getElementById("itemId"),s=document.getElementById("imagePreview");e&&(e.textContent="Neuer Gegenstand"),t&&(t.value="create"),n&&(n.textContent="Erstellen"),a&&(a.reset(),a.classList.remove("was-validated")),o&&(o.value=""),s&&(s.style.display="none")}function updateInventoryCardUI(e,t){const n=document.querySelector(`.inventory-card[data-item-id="${e}"]`);if(!n)return;const a=n.querySelector(`.quantity-display[data-item-id="${e}"]`);a&&(a.textContent=t);const o=n.querySelector(".inventory-badge");o&&(0===t?(o.className="badge bg-danger inventory-badge",o.textContent="Nicht verfügbar"):(o.className="badge bg-success inventory-badge",o.textContent=t+"x"));const s=n.querySelector(".status-indicator i");if(s){let e="success",n="Auf Lager";0===t?(e="danger",n="Nicht verfügbar"):t>=1&&t<=5&&(e="warning",n="Niedriger Bestand"),s.className=`fas fa-circle text-${e}`,s.setAttribute("title",n)}n.querySelectorAll(".quantity-btn").forEach(e=>{e.disabled=!1,e.querySelector(".fa-minus")&&(e.disabled=t<=0)}),0===t?n.classList.add("out-of-stock"):n.classList.remove("out-of-stock")}function adjustQuantity(e,t,n){const a=n.closest(".inventory-card").querySelectorAll(".quantity-btn");a.forEach(e=>toggleButtonLoading(e,!0));const o=new FormData;o.append("action","adjust_quantity"),o.append("id",e),o.append("adjustment",t),o.append("comment","");const s=getCsrfToken();s&&o.append("csrf_token",s),fetch(buildApiUrl("index.php?page=inventory"),{method:"POST",headers:addCsrfHeader({}),body:o}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(t=>{t.success?updateInventoryCardUI(e,t.newQuantity):showToast("Fehler: "+(t.message||"Unbekannter Fehler"),"danger")}).catch(e=>{console.error("Error adjusting quantity:",e),showToast("Ein Fehler ist aufgetreten.","danger")}).finally(()=>{a.forEach(e=>toggleButtonLoading(e,!1))})}function openQuantityCommentModal(e){document.getElementById("commentItemId").value=e;const t=document.getElementById("quantityComment");t&&(t.value="");const n=document.getElementById("quantityCommentModal"),a=new bootstrap.Modal(n);n.addEventListener("shown.bs.modal",function(){t&&t.focus()},{once:!0}),a.show()}function submitQuantityAdjustment(){const e=document.getElementById("commentItemId").value,t=document.getElementById("quantityComment").value.trim(),n=prompt("Mengenänderung eingeben (z.B. +5, -3):");if(null===n)return;const a=parseInt(n);if(isNaN(a)||0===a)return void showToast("Bitte geben Sie eine gültige Mengenänderung ein (z.B. +5 oder -3)","danger");bootstrap.Modal.getInstance(document.getElementById("quantityCommentModal")).hide();const o=document.querySelector(`.inventory-card[data-item-id="${e}"]`);if(!o)return void showToast("Fehler: Karte nicht gefunden","danger");const s=o.querySelectorAll(".quantity-btn");s.forEach(e=>toggleButtonLoading(e,!0));const i=new FormData;i.append("action","adjust_quantity"),i.append("id",e),i.append("adjustment",a),i.append("comment",t);const r=getCsrfToken();r&&i.append("csrf_token",r),fetch(buildApiUrl("index.php?page=inventory"),{method:"POST",headers:addCsrfHeader({}),body:i}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(n=>{n.success?(updateInventoryCardUI(e,n.newQuantity),showToast(t?"Menge erfolgreich aktualisiert mit Kommentar: "+t:"Menge erfolgreich aktualisiert","success")):showToast("Fehler: "+(n.message||"Unbekannter Fehler"),"danger")}).catch(e=>{console.error("Error adjusting quantity:",e),showToast("Ein Fehler ist aufgetreten.","danger")}).finally(()=>{s.forEach(e=>toggleButtonLoading(e,!1))})}function openEditModal(e){const t=document.getElementById("inventoryModalLabel"),n=document.getElementById("formAction"),a=document.getElementById("submitBtnText"),o=document.getElementById("imagePreview"),s=document.getElementById("inventoryForm");t&&(t.textContent="Gegenstand bearbeiten"),n&&(n.value="update"),a&&(a.textContent="Aktualisieren"),o&&(o.style.display="none"),s&&s.classList.remove("was-validated");const i=document.querySelector(`button[data-action="edit-inventory"][data-item-id="${e}"]`);i&&toggleButtonState(i,!0);const r=new FormData;r.append("action","get"),r.append("id",e),fetch(buildApiUrl("index.php?page=inventory"),{method:"POST",headers:addCsrfHeader({}),body:r}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{if(e.success){const t=e.item,n=document.getElementById("itemId"),a=document.getElementById("itemName"),s=document.getElementById("itemDescription"),i=document.getElementById("itemLocation"),r=document.getElementById("itemCategory"),l=document.getElementById("itemQuantity"),d=document.getElementById("itemPurchaseDate"),c=document.getElementById("itemTags");if(n&&(n.value=t.id),a&&(a.value=t.name||""),s&&(s.value=t.description||""),i&&(i.value=t.location||""),r&&(r.value=t.category||""),l&&(l.value=t.quantity||0),d&&(d.value=t.purchase_date||""),c&&(c.value=t.tags||""),t.image_path){const e=document.getElementById("previewImg");e&&o&&(e.src=BASE_URL+"/assets/uploads/inventory/"+encodeURIComponent(t.image_path),o.style.display="block")}const u=document.getElementById("inventoryModal");if(u&&"undefined"!=typeof bootstrap){new bootstrap.Modal(u).show()}}else showToast("Fehler beim Laden des Gegenstands: "+(e.message||"Unbekannter Fehler"),"danger")}).catch(e=>{console.error("Error loading item:",e),showToast("Ein Fehler ist aufgetreten beim Laden.","danger")}).finally(()=>{i&&toggleButtonState(i,!1)})}function deleteItem(e){if(!confirm("Möchten Sie diesen Gegenstand wirklich löschen?"))return;const t=document.querySelector(`button[data-action="delete-inventory"][data-item-id="${e}"]`);t&&toggleButtonState(t,!0);const n=new FormData;n.append("action","delete"),n.append("id",e);const a=getCsrfToken();a&&n.append("csrf_token",a),fetch(buildApiUrl("index.php?page=inventory"),{method:"POST",headers:addCsrfHeader({}),body:n}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{e.success?window.location.reload():(showToast("Fehler beim Löschen: "+(e.message||"Unbekannter Fehler"),"danger"),t&&toggleButtonState(t,!1))}).catch(e=>{console.error("Error deleting item:",e),showToast("Ein Fehler ist aufgetreten beim Löschen.","danger"),t&&toggleButtonState(t,!1)})}function filterCategory(e,t){document.querySelectorAll(".filter-pill").forEach(e=>{e.classList.remove("active")}),t&&t.classList.add("active");document.querySelectorAll(".inventory-card").forEach(t=>{const n=t.getAttribute("data-category")||"",a=t.closest(".col-12");"all"===e||n===e?a&&(a.style.display="block"):a&&(a.style.display="none")})}function initInventoryFormSubmit(){const e=document.getElementById("inventoryForm");e&&e.addEventListener("submit",async function(e){if(e.preventDefault(),e.stopPropagation(),!this.checkValidity())return void this.classList.add("was-validated");const t=this.querySelector('button[type="submit"]'),n=document.getElementById("submitSpinner");t&&toggleButtonLoading(t,!0),n&&(n.style.display="inline-block");const a=new FormData(this),o=getCsrfToken();o&&a.append("csrf_token",o);try{const e=await fetch(buildApiUrl("index.php?page=inventory"),{method:"POST",headers:addCsrfHeader({}),body:a});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const o=await e.json();if(o.success){const e=document.getElementById("inventoryModal");if(e&&"undefined"!=typeof bootstrap){const t=bootstrap.Modal.getInstance(e);t&&t.hide()}window.location.reload()}else showToast("Fehler: "+(o.message||"Unbekannter Fehler"),"danger"),t&&toggleButtonLoading(t,!1),n&&(n.style.display="none")}catch(e){console.error("Error submitting form:",e),showToast("Ein Fehler ist aufgetreten beim Speichern.","danger"),t&&toggleButtonLoading(t,!1),n&&(n.style.display="none")}})}function initInventoryDragDrop(){const e=document.getElementById("dragDropZone"),t=document.getElementById("itemImage");e&&t&&(e.addEventListener("click",()=>{t.click()}),e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("dragover")}),e.addEventListener("dragleave",()=>{e.classList.remove("dragover")}),e.addEventListener("drop",n=>{n.preventDefault(),e.classList.remove("dragover");const a=n.dataTransfer.files;if(a.length>0){t.files=a;const e=new Event("change",{bubbles:!0});t.dispatchEvent(e)}}))}function initInventoryManagement(){initInventoryImagePreview(),initInventoryFormSubmit(),initInventoryDragDrop(),initPerfectSearch(),initInventoryEventDelegation(),initInventoryBackToTop(),initQuickAddLocation()}function initInventoryBackToTop(){const e=document.getElementById("inventoryBackToTop");if(!e)return;let t=!1,n=null;window.addEventListener("scroll",function(){n||(n=setTimeout(()=>{(window.pageYOffset||document.documentElement.scrollTop)>500?t||(e.style.display="block",e.classList.remove("hide"),e.classList.add("show"),t=!0):t&&(e.classList.remove("show"),e.classList.add("hide"),setTimeout(()=>{e.classList.contains("show")||(e.style.display="none")},300),t=!1),n=null},100))},{passive:!0})}function initInventoryEventDelegation(){document.addEventListener("click",function(e){const t=e.target.closest("[data-action]");if(!t)return;const n=t.getAttribute("data-action"),a=t.getAttribute("data-item-id"),o=a?parseInt(a):null;switch(n){case"create-inventory":openCreateModal();break;case"edit-inventory":o&&openEditModal(o);break;case"delete-inventory":o&&deleteItem(o);break;case"adjust-quantity":const e=parseInt(t.getAttribute("data-adjustment"));o&&!isNaN(e)&&0!==e&&adjustQuantity(o,e,t);break;case"quantity-comment":o&&openQuantityCommentModal(o);break;case"submit-quantity-comment":submitQuantityAdjustment()}}),document.addEventListener("click",function(e){const t=e.target.closest(".filter-pill");if(!t)return;const n=t.getAttribute("data-filter-type"),a=t.getAttribute("data-value");n&&a&&applyFilter(n,a,t)}),document.addEventListener("keydown",function(e){const t=e.target.closest(".filter-pill");if(t&&("Enter"===e.key||" "===e.key)){e.preventDefault();const n=t.getAttribute("data-filter-type"),a=t.getAttribute("data-value");n&&a&&applyFilter(n,a,t)}})}function initButtonLoadingSpinners(){document.querySelectorAll("a.btn, button.btn:not([data-bs-dismiss]):not(.dropdown-toggle)").forEach(e=>{e.addEventListener("click",function(e){if(this.disabled||this.classList.contains("loading")||this.querySelector(".spinner-border"))return;if(this.hasAttribute("data-bs-toggle")||this.hasAttribute("data-bs-target"))return;if(this.getAttribute("onclick")?.includes("confirmDelete"))return;if("BUTTON"===this.tagName&&"button"===this.type&&!this.form)return;this.classList.add("loading"),this.disabled=!0;const t=document.createElement("span");t.className="spinner-border spinner-border-sm me-2",t.setAttribute("role","status"),t.setAttribute("aria-hidden","true"),this.insertBefore(t,this.firstChild)})})}function initEventCountdown(){const e=document.getElementById("event-countdown");if(!e)return;const t=e.getAttribute("data-event-date");if(!t)return void console.warn("Event countdown: data-event-date attribute is missing");const n=new Date(t);if(isNaN(n.getTime()))return void console.error("Event countdown: Invalid date format:",t);const a=document.getElementById("days"),o=document.getElementById("hours"),s=document.getElementById("minutes"),i=document.getElementById("seconds"),r=document.getElementById("countdown-display");if(!(a&&o&&s&&i&&r))return void console.warn("Event countdown: One or more countdown display elements are missing");const l=1e3;let d;const c=()=>{if(!document.body.contains(r))return void(d&&clearInterval(d));const e=new Date,t=n-e;if(t<=0){d&&clearInterval(d),r.style.display="none";const e=document.createElement("div");e.className="alert alert-success text-center";const t=document.createElement("i");t.className="fas fa-check-circle me-2";const n=document.createTextNode("Event läuft");return e.appendChild(t),e.appendChild(n),void(r.parentNode&&r.parentNode.insertBefore(e,r.nextSibling))}const c=864e5,u=36e5,m=Math.floor(t/c),p=Math.floor(t%c/u),g=Math.floor(t%u/6e4),f=Math.floor(t%6e4/l),h=e=>String(e).padStart(2,"0");a.textContent=h(m),o.textContent=h(p),s.textContent=h(g),i.textContent=h(f)};c(),d=setInterval(c,1e3)}function createAlumniSkeleton(e=6){const t=[];for(let n=0;n<e;n++)t.push('\n            <div class="col" aria-hidden="true">\n                <div class="card glass-card h-100">\n                    <div class="card-body p-4">\n                        \x3c!-- Profile Header with Avatar --\x3e\n                        <div class="d-flex align-items-start mb-3">\n                            \x3c!-- Avatar Placeholder --\x3e\n                            <div class="flex-shrink-0 me-3">\n                                <div class="placeholder-glow">\n                                    <div class="placeholder bg-secondary" style="width: 80px; height: 80px; border-radius: 50%;"></div>\n                                </div>\n                            </div>\n                            \n                            \x3c!-- Profile Info Placeholder --\x3e\n                            <div class="flex-grow-1">\n                                <div class="placeholder-glow mb-2">\n                                    <span class="placeholder col-8 bg-secondary"></span>\n                                </div>\n                                <div class="placeholder-glow">\n                                    <span class="placeholder col-6 bg-secondary"></span>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Position and Company Placeholder --\x3e\n                        <div class="mb-3">\n                            <div class="placeholder-glow mb-2">\n                                <span class="placeholder col-10 bg-secondary"></span>\n                            </div>\n                            <div class="placeholder-glow">\n                                <span class="placeholder col-8 bg-secondary"></span>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Bio Placeholder --\x3e\n                        <div class="mb-3">\n                            <div class="placeholder-glow">\n                                <span class="placeholder col-12 bg-secondary"></span>\n                                <span class="placeholder col-12 bg-secondary"></span>\n                                <span class="placeholder col-9 bg-secondary"></span>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Badges Placeholder --\x3e\n                        <div class="mb-3">\n                            <div class="placeholder-glow">\n                                <span class="placeholder col-4 bg-secondary" style="height: 24px; display: inline-block; border-radius: 12px; margin-right: 8px;"></span>\n                                <span class="placeholder col-4 bg-secondary" style="height: 24px; display: inline-block; border-radius: 12px;"></span>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Contact Buttons Placeholder --\x3e\n                        <div class="d-flex gap-2 pt-2 border-top">\n                            <div class="placeholder-glow flex-fill">\n                                <span class="placeholder col-12 bg-secondary" style="height: 32px; display: block; border-radius: 6px;"></span>\n                            </div>\n                            <div class="placeholder-glow flex-fill">\n                                <span class="placeholder col-12 bg-secondary" style="height: 32px; display: block; border-radius: 6px;"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ');return t.join("")}function initAlumniDatabaseSearch(){const e=document.getElementById("alumniDatabaseSearch"),t=document.getElementById("alumniDatabaseGrid"),n=document.getElementById("alumniSearchSpinner"),a=document.getElementById("graduationYearFilter");if(!e||!t)return;const o=window.ALUMNI_BIO_PREVIEW_LENGTH||120;let s=null;function i(e,a){n&&(n.style.display="flex"),t&&(t.innerHTML=createAlumniSkeleton(6));const s=new FormData;s.append("action","search"),s.append("search",e),a&&!isNaN(parseInt(a))&&s.append("graduation_year",parseInt(a)),fetch(window.location.href,{method:"POST",headers:addCsrfHeader({}),body:s}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(a=>{n&&(n.style.display="none"),a.success?function(e,n){if(!t)return;if(t.innerHTML="",0===e.length)return void(t.innerHTML=`\n                <div class="col-12">\n                    <div class="card glass-card text-center py-5 px-4">\n                        <div class="card-body">\n                            <i class="fas fa-user-friends fa-4x text-muted mb-3"></i>\n                            <h4>Keine Alumni-Profile gefunden</h4>\n                            <p class="text-muted">\n                                ${n?"Ihre Suche ergab keine Treffer. Versuchen Sie andere Suchbegriffe.":"Das Alumni-Netzwerk wird derzeit aufgebaut. Schauen Sie bald wieder vorbei!"}\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            `);const a=window.currentUserId||null,s=window.canEditAlumni||!1;e.forEach((e,n)=>{const i=a&&parseInt(e.created_by)===parseInt(a),r=s||i,d=document.createElement("div");d.className="col",d.setAttribute("data-aos","fade-up"),d.setAttribute("data-aos-delay",n%3*100),d.innerHTML=`\n                <div class="card glass-card h-100" data-profile-id="${e.id}">\n                    <div class="card-body p-4">\n                        \x3c!-- Profile Header with Avatar --\x3e\n                        <div class="d-flex align-items-start mb-3">\n                            \x3c!-- Profile Picture / Avatar --\x3e\n                            <div class="flex-shrink-0 me-3">\n                                ${e.profile_picture?`\n                                    <img src="${l(e.profile_picture)}" \n                                         alt="${l(e.firstname+" "+e.lastname)}" \n                                         class="alumni-avatar-container" \n                                         style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">\n                                `:'\n                                    <div class="alumni-avatar-container" style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, var(--ibc-blue) 0%, var(--ibc-green) 100%); display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">\n                                        <i class="fas fa-user fa-2x text-white"></i>\n                                    </div>\n                                '}\n                            </div>\n                            \n                            \x3c!-- Profile Info --\x3e\n                            <div class="flex-grow-1">\n                                <h5 class="card-title mb-1 fw-bold" style="color: var(--ibc-blue);">\n                                    ${l(e.firstname+" "+e.lastname)}\n                                </h5>\n                                ${e.graduation_year?`\n                                    <small class="text-muted">\n                                        <i class="fas fa-graduation-cap me-1"></i>Jahrgang ${l(e.graduation_year)}\n                                    </small>\n                                `:""}\n                            </div>\n                            \n                            \x3c!-- Edit Button --\x3e\n                            ${r?`\n                                <div class="dropdown">\n                                    <button class="btn btn-sm btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="Aktionen">\n                                        <i class="fas fa-ellipsis-v"></i>\n                                    </button>\n                                    <ul class="dropdown-menu dropdown-menu-end">\n                                        <li>\n                                            <a class="dropdown-item" href="#" data-action="edit-alumni-profile" data-profile-id="${e.id}">\n                                                <i class="fas fa-edit me-2"></i>\n                                                ${i?"Profil bearbeiten":"Bearbeiten"}\n                                            </a>\n                                        </li>\n                                        ${s?`\n                                            <li><hr class="dropdown-divider"></li>\n                                            <li>\n                                                <a class="dropdown-item text-danger" href="#" data-action="delete-alumni-profile" data-profile-id="${e.id}">\n                                                    <i class="fas fa-trash me-2"></i>Löschen\n                                                </a>\n                                            </li>\n                                        `:""}\n                                    </ul>\n                                </div>\n                            `:""}\n                        </div>\n                        \n                        \x3c!-- Position and Company --\x3e\n                        ${e.position||e.company?`\n                            <div class="mb-3">\n                                ${e.position?`\n                                    <p class="mb-1 fw-semibold" style="color: var(--ibc-text-primary);">\n                                        <i class="fas fa-briefcase me-2 text-primary"></i>\n                                        ${l(e.position)}\n                                    </p>\n                                `:""}\n                                ${e.company?`\n                                    <p class="text-muted mb-0">\n                                        <i class="fas fa-building me-2"></i>\n                                        ${l(e.company)}\n                                    </p>\n                                `:""}\n                            </div>\n                        `:""}\n                        \n                        \x3c!-- Bio Preview --\x3e\n                        ${e.bio?`\n                            <p class="card-text text-muted small mb-3" style="line-height: 1.6;">\n                                ${l(e.bio.length>o?e.bio.substring(0,o)+"...":e.bio)}\n                            </p>\n                        `:""}\n                        \n                        \x3c!-- Badges --\x3e\n                        ${e.industry||e.location?`\n                            <div class="mb-3">\n                                ${e.industry?`\n                                    <span class="badge bg-info me-2">\n                                        <i class="fas fa-industry me-1"></i>${l(e.industry)}\n                                    </span>\n                                `:""}\n                                ${e.location?`\n                                    <span class="badge bg-primary">\n                                        <i class="fas fa-map-marker-alt me-1"></i>${l(e.location)}\n                                    </span>\n                                `:""}\n                            </div>\n                        `:""}\n                        \n                        \x3c!-- Social Contact Links --\x3e\n                        <div class="d-flex gap-2 pt-2 border-top">\n                            ${e.email?`\n                                <a href="mailto:${l(e.email)}" \n                                   class="btn btn-sm btn-outline-primary flex-fill" \n                                   title="E-Mail senden"\n                                   style="border-radius: var(--border-radius-soft);">\n                                    <i class="fas fa-envelope"></i>\n                                    <span class="d-none d-md-inline ms-1">E-Mail</span>\n                                </a>\n                            `:""}\n                            \n                            ${e.phone?`\n                                <a href="tel:${l(e.phone)}" \n                                   class="btn btn-sm btn-outline-primary flex-fill" \n                                   title="Anrufen"\n                                   style="border-radius: var(--border-radius-soft);">\n                                    <i class="fas fa-phone"></i>\n                                    <span class="d-none d-md-inline ms-1">Anrufen</span>\n                                </a>\n                            `:""}\n                            \n                            ${e.linkedin_url?`\n                                <a href="${l(e.linkedin_url)}" \n                                   target="_blank" \n                                   rel="noopener noreferrer"\n                                   class="btn btn-sm btn-outline-primary flex-fill" \n                                   title="LinkedIn-Profil anzeigen"\n                                   style="border-radius: var(--border-radius-soft);">\n                                    <i class="fab fa-linkedin"></i>\n                                    <span class="d-none d-md-inline ms-1">LinkedIn</span>\n                                </a>\n                            `:""}\n                        </div>\n                    </div>\n                </div>\n            `,t.appendChild(d)})}(a.profiles,e):(console.error("Search failed:",a.message),r())}).catch(e=>{console.error("Search error:",e),n&&(n.style.display="none"),r()})}function r(){t&&(t.innerHTML='\n            <div class="col-12">\n                <div class="card glass-card text-center py-5 px-4 border-danger">\n                    <div class="card-body">\n                        <i class="fas fa-exclamation-triangle fa-4x text-danger mb-3" style="opacity: 0.5;"></i>\n                        <h4 class="text-danger">Fehler beim Laden</h4>\n                        <p class="text-muted">\n                            Es ist ein Fehler beim Laden der Alumni-Daten aufgetreten. \n                            Bitte versuchen Sie es später erneut.\n                        </p>\n                        <button type="button" class="btn btn-danger" onclick="location.reload()">\n                            <i class="fas fa-sync-alt me-2"></i>Seite neu laden\n                        </button>\n                    </div>\n                </div>\n            </div>\n        ')}function l(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return String(e).replace(/[&<>"']/g,e=>t[e])}e.addEventListener("input",function(e){const t=e.target.value.trim(),n=a?a.value:"";s&&clearTimeout(s),s=setTimeout(()=>{i(t,n)},300)}),a&&a.addEventListener("change",function(t){i(e.value.trim(),t.target.value)})}function initAlumniEditModal(){const e=document.getElementById("alumniEditModal"),t=document.getElementById("alumniEditForm"),n=document.getElementById("profilePictureInput"),a=document.getElementById("profilePicturePreview");e&&t&&(document.addEventListener("click",function(t){const o=t.target.closest('[data-action="edit-alumni-profile"]');if(!o)return;t.preventDefault();const s=o.getAttribute("data-profile-id");s&&function(t){const o=document.querySelector(".container[data-csrf-token]")?.getAttribute("data-csrf-token");if(!o)return void showToast("CSRF-Token nicht gefunden. Bitte laden Sie die Seite neu.","danger");const s=document.querySelector(`a[data-action="edit-alumni-profile"][data-profile-id="${t}"]`);s&&toggleButtonState(s,!0);const i=new FormData;i.append("action","get"),i.append("id",t),i.append("csrf_token",o),fetch(window.location.href,{method:"POST",headers:addCsrfHeader({}),body:i}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(t=>{if(t.success&&t.profile){!function(e){document.getElementById("editProfileId").value=e.id||"",document.getElementById("editFirstname").value=e.firstname||"",document.getElementById("editLastname").value=e.lastname||"",document.getElementById("editEmail").value=e.email||"",document.getElementById("editPhone").value=e.phone||"",document.getElementById("editCompany").value=e.company||"",document.getElementById("editPosition").value=e.position||"",document.getElementById("editIndustry").value=e.industry||"",document.getElementById("editLocation").value=e.location||"",document.getElementById("editGraduationYear").value=e.graduation_year||"",document.getElementById("editLinkedIn").value=e.linkedin_url||"",document.getElementById("editBio").value=e.bio||"",document.getElementById("editIsPublished").checked=1==e.is_published,e.profile_picture?a.innerHTML=`<img src="${escapeHtml(e.profile_picture)}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`:a.innerHTML='<i class="fas fa-user fa-4x text-white"></i>';n&&(n.value="")}(t.profile);new bootstrap.Modal(e).show();e.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(function(e){new bootstrap.Tooltip(e)})}else showToast(t.message||"Fehler beim Laden des Profils","danger")}).catch(e=>{console.error("Error loading profile:",e),showToast("Fehler beim Laden des Profils","danger")}).finally(()=>{s&&toggleButtonState(s,!1)})}(s)}),n&&n.addEventListener("change",function(e){const t=e.target.files[0];if(t){if(!["image/jpeg","image/png","image/gif","image/webp"].includes(t.type))return showToast("Bitte wählen Sie ein gültiges Bildformat (JPG, PNG, GIF, WebP)","warning"),void(e.target.value="");const n=5242880;if(t.size>n)return showToast("Das Bild ist zu groß. Maximale Größe: 5MB","warning"),void(e.target.value="");const o=new FileReader;o.onload=function(e){a.innerHTML=`<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`},o.readAsDataURL(t)}}),t.addEventListener("submit",function(n){if(n.preventDefault(),!t.checkValidity())return n.stopPropagation(),void t.classList.add("was-validated");const a=document.getElementById("alumniEditSubmitBtn"),o=document.getElementById("editSubmitBtnText"),s=document.getElementById("editSubmitSpinner");a&&toggleButtonLoading(a,!0),o&&(o.textContent="Wird gespeichert..."),s&&(s.style.display="inline-block");const i=document.querySelector(".container[data-csrf-token]")?.getAttribute("data-csrf-token");if(!i)return showToast("CSRF-Token nicht gefunden. Bitte laden Sie die Seite neu.","danger"),a&&toggleButtonLoading(a,!1),o&&(o.textContent="Speichern"),void(s&&(s.style.display="none"));const r=new FormData(t);r.append("action","update"),r.append("csrf_token",i),fetch(window.location.href,{method:"POST",headers:addCsrfHeader({}),body:r}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(t=>{if(t.success){showToast(t.message||"Profil erfolgreich aktualisiert","success");const n=bootstrap.Modal.getInstance(e);n&&n.hide(),setTimeout(()=>{window.location.reload()},1e3)}else showToast(t.message||"Fehler beim Aktualisieren des Profils","danger")}).catch(e=>{console.error("Error updating profile:",e),showToast("Fehler beim Aktualisieren des Profils","danger")}).finally(()=>{a&&toggleButtonLoading(a,!1),o&&(o.textContent="Speichern"),s&&(s.style.display="none")})}))}function initEditModeToggle(){const e=[document.getElementById("edit-mode-toggle"),document.getElementById("edit-mode-fab")].filter(e=>null!==e);if(0===e.length)return;function t(){const t=e[0].classList.contains("active");e.forEach(e=>{toggleButtonState(e,!0)});const n=!t;e.forEach(e=>{n?e.classList.add("active"):e.classList.remove("active")}),document.body.classList.toggle("edit-mode-active",n);const a=document.getElementById("edit-mode-banner");a&&(n?a.classList.add("show"):a.classList.remove("show")),fetch(buildApiUrl("api/set_edit_mode.php"),{method:"POST",headers:addCsrfHeader({"Content-Type":"application/x-www-form-urlencoded"}),body:"action=toggle_edit_mode"}).then(e=>e.json()).then(n=>{if(n.success){const e=n.edit_mode_active?"aktiviert":"deaktiviert";console.log(`Edit-Modus ${e}`)}else e.forEach(e=>{t?e.classList.add("active"):e.classList.remove("active")}),document.body.classList.toggle("edit-mode-active",t),a&&(t?a.classList.add("show"):a.classList.remove("show")),console.error("Failed to toggle edit mode:",n.message)}).catch(n=>{e.forEach(e=>{t?e.classList.add("active"):e.classList.remove("active")}),document.body.classList.toggle("edit-mode-active",t),a&&(t?a.classList.add("show"):a.classList.remove("show")),console.error("Error toggling edit mode:",n)}).finally(()=>{e.forEach(e=>{toggleButtonState(e,!1)})})}"true"===e[0].dataset.editModeActive&&e.forEach(e=>e.classList.add("active")),e.forEach(e=>{e.addEventListener("click",t)})}function getCsrfToken(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):null}function addCsrfHeader(e={}){const t=getCsrfToken();return t&&(e["X-CSRF-Token"]=t),e}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){initAlumniDatabaseSearch(),initAlumniEditModal(),initEditModeToggle()}):(initAlumniDatabaseSearch(),initAlumniEditModal(),initEditModeToggle()),function(){"use strict";const e=["navbar-item-projects","navbar-item-inventory"];let t,n=!1,a=new Map;function o(e,t){const o=function(){if(n)return document.getElementById("more-dropdown-container");const e=document.querySelector(".navbar-nav");if(!e)return null;const t=document.createElement("li");t.className="nav-item dropdown",t.id="more-dropdown-container";const a=document.createElement("a");a.className="nav-link dropdown-toggle",a.href="#",a.id="moreDropdown",a.setAttribute("role","button"),a.setAttribute("data-bs-toggle","dropdown"),a.setAttribute("aria-expanded","false"),a.innerHTML='<i class="fas fa-ellipsis-h me-2"></i>Mehr';const o=document.createElement("ul");o.className="dropdown-menu",o.setAttribute("aria-labelledby","moreDropdown"),o.id="more-dropdown-menu",t.appendChild(a),t.appendChild(o);const s=document.getElementById("notificationBellContainer");return s?e.insertBefore(t,s):e.appendChild(t),n=!0,t}();if(!o)return;const s=o.querySelector("#more-dropdown-menu");if(!s)return;a.has(t)||a.set(t,e);const i=e.querySelector("a");if(!i)return;const r=document.createElement("li"),l=document.createElement("a");l.className="dropdown-item",l.href=i.href,l.innerHTML=i.innerHTML,r.setAttribute("data-link-id",t),r.appendChild(l),s.appendChild(r),e.classList.add("d-lg-block"),e.classList.add("d-none")}function s(){const t=window.innerWidth;e.forEach(e=>{const a=document.getElementById(e);a&&(t<992?a.classList.contains("d-none")&&n||o(a,e):function(e,t){const a=document.getElementById("more-dropdown-container");if(e.classList.remove("d-none"),a){const e=a.querySelector("#more-dropdown-menu");e&&(e.querySelectorAll(`li[data-link-id="${t}"]`).forEach(e=>e.remove()),0===e.children.length&&(a.remove(),n=!1))}}(a,e))})}document.addEventListener("DOMContentLoaded",function(){s()}),window.addEventListener("resize",function(){clearTimeout(t),t=setTimeout(function(){s()},250)})}(),function(){"use strict";function e(){const e=document.getElementById("mobileSearchOverlay");e&&e.classList.remove("active")}document.addEventListener("DOMContentLoaded",function(){!function(){const t=document.getElementById("mobileSearchBtn"),n=document.getElementById("mobileSearchOverlay"),a=document.getElementById("mobileSearchClose");if(!t||!n)return;t.addEventListener("click",function(e){e.preventDefault(),function(){const e=document.getElementById("mobileSearchOverlay");e&&(e.classList.add("active"),setTimeout(function(){const t=e.querySelector('input[type="search"], input[type="text"]');t&&t.focus()},300))}()}),a&&a.addEventListener("click",function(t){t.preventDefault(),e()});document.addEventListener("keydown",function(t){"Escape"===t.key&&n.classList.contains("active")&&e()})}(),function(){const e=document.getElementById("mobileNotificationBell"),t=document.getElementById("notificationBell");if(!e||!t)return;e.addEventListener("click",function(e){e.preventDefault();const n=new CustomEvent("showNotifications",{bubbles:!0,detail:{source:"mobile"}});t.dispatchEvent(n),t.click();const a=document.getElementById("notificationPanel");a&&a.classList.add("mobile-positioned")})}()})}();const NEWS_CONFIG={FADE_DURATION:400,LOAD_MORE_LIMIT:6},NEWS_BASE_URL=window.ibcConfig?.baseUrl??window.appConfig?.baseUrl??"",NEWS_API_URL=window.ibcConfig?.apiUrl??window.appConfig?.baseUrl??"";function createNewsSkeletonLoaders(e=6){const t=[];for(let n=0;n<e;n++)t.push('\n            <div class="col skeleton-loader-item" aria-hidden="true">\n                <div class="card h-100">\n                    <div class="placeholder-glow">\n                        <div class="placeholder col-12 bg-secondary" style="height: 12.5rem;"></div>\n                    </div>\n                    <div class="card-body d-flex flex-column">\n                        <div class="placeholder-glow mb-2">\n                            <span class="placeholder col-4 bg-secondary"></span>\n                        </div>\n                        <div class="placeholder-glow mb-2">\n                            <span class="placeholder col-10 bg-secondary"></span>\n                            <span class="placeholder col-8 bg-secondary"></span>\n                        </div>\n                        <div class="placeholder-glow flex-grow-1 mb-3">\n                            <span class="placeholder col-12 bg-secondary"></span>\n                            <span class="placeholder col-11 bg-secondary"></span>\n                            <span class="placeholder col-9 bg-secondary"></span>\n                        </div>\n                        <div class="placeholder-glow mb-3">\n                            <span class="placeholder col-6 bg-secondary"></span>\n                        </div>\n                        <div class="placeholder-glow">\n                            <span class="placeholder col-12 btn btn-outline-primary disabled"></span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ');return t.join("")}function showNewsSkeletonLoaders(e,t=6){const n=createNewsSkeletonLoaders(t);e.insertAdjacentHTML("beforeend",n)}function removeNewsSkeletonLoaders(e){e.querySelectorAll(".skeleton-loader-item").forEach(e=>e.remove())}function loadMoreNews(){const e=document.getElementById("loadMoreBtn"),t=document.getElementById("loadingSpinner"),n=document.getElementById("newsGrid");if(!e||!n)return void console.error("Required elements not found for loadMoreNews");const a=parseInt(e.getAttribute("data-offset"))||0;"function"==typeof toggleButtonState?toggleButtonState(e,!0):e.classList.add("d-none"),t&&t.classList.remove("d-none"),showNewsSkeletonLoaders(n,NEWS_CONFIG.LOAD_MORE_LIMIT);const o=new FormData;o.append("action","load_more"),o.append("offset",a),o.append("limit",NEWS_CONFIG.LOAD_MORE_LIMIT),fetch(buildApiUrl("index.php?page=newsroom"),{method:"POST",body:o,headers:addCsrfHeader({"X-Requested-With":"XMLHttpRequest"})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(o=>{if(removeNewsSkeletonLoaders(n),t&&t.classList.add("d-none"),o.success&&o.articles&&o.articles.length>0){appendArticlesToGrid(o.articles,n);const t=a+o.articles.length;e.setAttribute("data-offset",t),"function"==typeof toggleButtonState?toggleButtonState(e,!1):e.classList.remove("d-none"),o.articles.length<NEWS_CONFIG.LOAD_MORE_LIMIT&&(e.disabled=!0,e.innerHTML='<i class="fas fa-check me-2"></i>Alle Beiträge geladen')}else{if(0!==o.articles?.length)throw new Error(o.message||"Unerwartetes Antwortformat vom Server");{const t=document.createElement("div");t.className="col-12 fade-in-news",t.innerHTML='\n                <div class="alert alert-info text-center">\n                    <i class="fas fa-info-circle me-2"></i>\n                    Keine weiteren Beiträge verfügbar.\n                </div>\n            ';const n=e.parentElement.parentElement;n.parentElement.insertBefore(t,n),setTimeout(()=>{t.classList.add("visible")},10),e.remove()}}}).catch(a=>{console.error("Error loading more news:",a),removeNewsSkeletonLoaders(n),t&&t.classList.add("d-none");const o=document.querySelector(".load-more-error-message");o&&o.remove(),e.innerHTML='<i class="fas fa-sync-alt me-2"></i>Fehler – Erneut versuchen',e.dataset.originalContent&&(e.dataset.originalContent='<i class="fas fa-sync-alt me-2"></i>Fehler – Erneut versuchen'),"function"==typeof toggleButtonState?toggleButtonState(e,!1):(e.classList.remove("d-none"),e.disabled=!1);const s=document.createElement("div");s.className="col-12 fade-in-news load-more-error-message",s.innerHTML='\n            <div class="alert alert-danger text-center">\n                <i class="fas fa-exclamation-triangle me-2"></i>\n                Netzwerkfehler beim Laden der Beiträge. Bitte versuchen Sie es erneut.\n            </div>\n        ';const i=e.parentElement.parentElement;i.parentElement.insertBefore(s,i),setTimeout(()=>{s.classList.add("visible")},10),"function"==typeof showToast&&showToast("Netzwerkfehler beim Laden der Beiträge","danger")})}function appendArticlesToGrid(e,t){if(!e||0===e.length)return;const n=document.createDocumentFragment();e.forEach((e,t)=>{const a=createNewsCard(e);a.classList.add("fade-in-news"),n.appendChild(a),setTimeout(()=>{a.classList.add("visible")},100*t)}),t.appendChild(n),"undefined"!=typeof AOS&&AOS.refresh()}function createNewsCard(e){const t=document.createElement("div");t.className="col";const n=e=>{if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML};var a;return t.innerHTML=`\n        <div class="card h-100" style="border-radius: 1.5rem; transition: transform var(--transition-smooth), box-shadow var(--transition-smooth);">\n            ${e.image_path?`\n                <img \n                    src="${NEWS_BASE_URL}/${n(e.image_path).replace(/^\/+/,"")}" \n                    class="card-img-top" \n                    alt="${n(e.title)}"\n                    style="height: 200px; object-fit: cover; border-radius: 1.5rem 1.5rem 0 0;"\n                >\n            `:'\n                <div class="bg-gradient-animated" style="height: 200px; border-radius: 1.5rem 1.5rem 0 0;"></div>\n            '}\n            \n            <div class="card-body d-flex flex-column">\n                ${e.category?`\n                    <span class="badge bg-secondary mb-2" style="width: fit-content;">\n                        ${n(e.category)}\n                    </span>\n                `:""}\n                \n                <h5 class="card-title">\n                    ${n(e.title)}\n                </h5>\n                \n                <p class="card-text text-muted flex-grow-1">\n                    ${((e,t=120)=>{const a=e.replace(/<[^>]*>/g,"");return a.length<=t?n(a):n(a.substring(0,t)+"...")})(e.content)}\n                </p>\n                \n                <div class="d-flex align-items-center mb-3">\n                    <small class="text-muted">\n                        <i class="fas fa-calendar me-1"></i>\n                        ${a=e.created_at,new Date(a).toLocaleDateString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit"})}\n                    </small>\n                </div>\n                \n                ${e.cta_link&&e.cta_label?`\n                    <a href="${n(e.cta_link)}" class="btn btn-outline-primary w-100">\n                        ${n(e.cta_label)}\n                        <i class="fas fa-arrow-right ms-2"></i>\n                    </a>\n                `:""}\n            </div>\n        </div>\n    `,t}function toggleNewsSubscription(){const e=document.getElementById("newsSubscriptionToggle");e?e.addEventListener("change",function(){const e=this.checked?"subscribe":"unsubscribe",t=!this.checked;this.disabled=!0,fetch(buildApiUrl("index.php?page=newsroom"),{method:"POST",headers:addCsrfHeader({"Content-Type":"application/x-www-form-urlencoded"}),body:"action="+encodeURIComponent(e)}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(n=>{if(this.disabled=!1,n.success){"function"==typeof showToast&&showToast("subscribe"===e?"News-Benachrichtigungen aktiviert":"News-Benachrichtigungen deaktiviert","success")}else{this.checked=t;const e=n.message||"Fehler beim Aktualisieren der Benachrichtigungseinstellungen";"function"==typeof showToast?showToast(e,"danger"):alert(e)}}).catch(e=>{console.error("Error toggling subscription:",e),this.disabled=!1,this.checked=t;const n="Fehler beim Aktualisieren der Benachrichtigungseinstellungen";"function"==typeof showToast?showToast(n,"danger"):alert(n)})}):console.error("Subscription toggle element not found")}function initNewsModule(){toggleNewsSubscription();const e=document.getElementById("loadMoreBtn");e&&e.addEventListener("click",loadMoreNews)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initNewsModule):initNewsModule();const styleElement=document.createElement("style");function initializeSearchInstances(){document.querySelectorAll(".global-search-input").forEach(e=>{const t=e.dataset.searchInstance,n=document.querySelector(`.global-search-results[data-search-instance="${t}"]`),a=document.querySelector(`.global-search-submit[data-search-instance="${t}"]`);if(!n)return;let o=null;e.addEventListener("input",function(){clearTimeout(o);const e=this.value.trim();return e.length<2?(n.classList.remove("show"),void(n.innerHTML="")):e.length>100?(n.innerHTML='<div class="dropdown-item text-warning">Suchanfrage zu lang (max. 100 Zeichen)</div>',void n.classList.add("show")):void(o=setTimeout(function(){performSearch(e,t,n)},300))}),e.addEventListener("keypress",function(e){if("Enter"===e.key){e.preventDefault();const a=this.value.trim();a.length>=2&&a.length<=100&&performSearch(a,t,n)}}),a&&a.addEventListener("click",function(){const a=e.value.trim();a.length>=2&&a.length<=100&&performSearch(a,t,n)})}),document.addEventListener("click",function(e){document.querySelectorAll(".global-search-wrapper").forEach(t=>{if(!t.contains(e.target)){const e=t.querySelector(".global-search-results");e&&e.classList.remove("show")}})})}function createGlobalSearchSkeleton(){let e='<div class="dropdown-header bg-light border-bottom placeholder-glow">';return e+='<span class="placeholder col-6 bg-secondary"></span>',e+="</div>",[{icon:"fa-boxes",name:"Gegenstände",count:2},{icon:"fa-user-graduate",name:"Personen",count:2},{icon:"fa-newspaper",name:"News",count:1},{icon:"fa-calendar-alt",name:"Events",count:1},{icon:"fa-briefcase",name:"Projekte",count:1}].forEach(t=>{e+=`<h6 class="dropdown-header placeholder-glow">\n            <i class="fas ${t.icon} me-2"></i>\n            <span class="placeholder col-4 bg-secondary"></span>\n        </h6>`;for(let n=0;n<t.count;n++)e+='<div class="dropdown-item" aria-hidden="true">\n                <div class="placeholder-glow">\n                    <div class="fw-bold mb-1">\n                        <span class="placeholder col-8 bg-secondary"></span>\n                    </div>\n                    <small class="text-muted d-block">\n                        <span class="placeholder col-10 bg-secondary"></span>\n                    </small>\n                </div>\n            </div>';e+='<div class="dropdown-divider"></div>'}),e}function performSearch(e,t,n){n.innerHTML=createGlobalSearchSkeleton(),n.classList.add("show"),fetch("api/global_search.php?q="+encodeURIComponent(e)).then(e=>e.json()).then(e=>{e.success?displaySearchResults(e.results,e.counts,e.total,t,n):(n.innerHTML='<div class="dropdown-item text-danger">'+escapeHtml(e.message||"Fehler bei der Suche")+"</div>",n.classList.add("show"))}).catch(e=>{console.error("Search error:",e),n.innerHTML='<div class="dropdown-item text-danger">Fehler bei der Suche</div>',n.classList.add("show")})}function pluralize(e,t,n){return e+" "+(1!==e?n:t)}function displaySearchResults(e,t,n,a,o){let s="";if(0===n)s='<div class="dropdown-item text-muted">Keine Ergebnisse gefunden</div>';else{s+='<div class="dropdown-header bg-light border-bottom">',s+="<strong>"+n+" Ergebnisse gefunden:</strong>",s+='<div class="mt-1 small">';const a=[];t.user>0&&a.push(pluralize(t.user,"Person","Personen")),t.inventory>0&&a.push(pluralize(t.inventory,"Gegenstand","Gegenstände")),t.news>0&&a.push(t.news+" News"),t.event>0&&a.push(pluralize(t.event,"Event","Events")),t.project>0&&a.push(pluralize(t.project,"Projekt","Projekte")),s+=a.join(" · "),s+="</div></div>",e.inventory&&e.inventory.length>0&&(s+='<h6 class="dropdown-header"><i class="fas fa-boxes me-2"></i>Gegenstände ('+t.inventory+")</h6>",e.inventory.forEach(e=>{const t=e.quantity>0?`<span class="badge bg-success ms-2">${e.quantity}x</span>`:'<span class="badge bg-secondary ms-2">0x</span>';s+=`<a href="${escapeHtml(e.url)}" class="dropdown-item">\n                    <div class="fw-bold">${escapeHtml(e.title)} ${t}</div>\n                    <small class="text-muted">${escapeHtml(e.subtitle)}</small>\n                </a>`}),s+='<div class="dropdown-divider"></div>'),e.user&&e.user.length>0&&(s+='<h6 class="dropdown-header"><i class="fas fa-user-graduate me-2"></i>Personen ('+t.user+")</h6>",e.user.forEach(e=>{s+=`<a href="${escapeHtml(e.url)}" class="dropdown-item">\n                    <div class="fw-bold">${escapeHtml(e.title)}</div>\n                    <small class="text-muted">${escapeHtml(e.subtitle)}</small>\n                </a>`}),s+='<div class="dropdown-divider"></div>'),e.news&&e.news.length>0&&(s+='<h6 class="dropdown-header"><i class="fas fa-newspaper me-2"></i>News ('+t.news+")</h6>",e.news.forEach(e=>{s+=`<a href="${escapeHtml(e.url)}" class="dropdown-item">\n                    <div class="fw-bold">${escapeHtml(e.title)}</div>\n                    <small class="text-muted">${escapeHtml(e.subtitle)} · ${formatDate(e.date)}</small>\n                </a>`}),s+='<div class="dropdown-divider"></div>'),e.event&&e.event.length>0&&(s+='<h6 class="dropdown-header"><i class="fas fa-calendar-alt me-2"></i>Events ('+t.event+")</h6>",e.event.forEach(e=>{s+=`<a href="${escapeHtml(e.url)}" class="dropdown-item">\n                    <div class="fw-bold">${escapeHtml(e.title)}</div>\n                    <small class="text-muted">${escapeHtml(e.subtitle)} · ${formatDate(e.date)}</small>\n                </a>`}),s+='<div class="dropdown-divider"></div>'),e.project&&e.project.length>0&&(s+='<h6 class="dropdown-header"><i class="fas fa-briefcase me-2"></i>Projekte ('+t.project+")</h6>",e.project.forEach(e=>{s+=`<a href="${escapeHtml(e.url)}" class="dropdown-item">\n                    <div class="fw-bold">${escapeHtml(e.title)}</div>\n                    <small class="text-muted">${escapeHtml(e.subtitle)} · ${formatDate(e.date)}</small>\n                </a>`}))}o.innerHTML=s,o.classList.add("show")}function escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function formatDate(e){if(!e)return"";return new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}styleElement.textContent=`\n    .fade-in-news {\n        opacity: 0;\n        transform: translateY(20px);\n        transition: opacity ${NEWS_CONFIG.FADE_DURATION}ms ease-out, \n                    transform ${NEWS_CONFIG.FADE_DURATION}ms ease-out;\n    }\n    \n    .fade-in-news.visible {\n        opacity: 1;\n        transform: translateY(0);\n    }\n`,document.head.appendChild(styleElement),function(){"use strict";let e=0,t=0,n=!1,a=!1,o=null;function s(){return window.innerWidth<992}function i(){return 0===(document.querySelector(".main-content")||document.documentElement).scrollTop||0===window.pageYOffset}function r(t){s()&&!a&&i()&&(e=t.touches[0].clientY,n=!0)}function l(s){if(!n||a)return;t=s.touches[0].clientY;const r=t-e;if(r>0&&i()){s.preventDefault();const e=Math.min(.5*r,120);if(o){o.style.transform=`translateY(${e}px)`,o.style.opacity=Math.min(e/80,1);const t=o.querySelector(".pull-to-refresh-spinner i"),n=o.querySelector(".pull-to-refresh-text");r>=80?(t.style.transform="rotate(180deg)",n.textContent="Loslassen zum Aktualisieren",o.classList.add("ready")):(t.style.transform=`rotate(${2*r}deg)`,n.textContent="Zum Aktualisieren ziehen",o.classList.remove("ready"))}}}function d(s){if(!n||a)return;t-e>=80&&i()?function(){if(a)return;if(a=!0,o){const e=o.querySelector(".pull-to-refresh-text"),t=o.querySelector(".pull-to-refresh-spinner i");e.textContent="Wird aktualisiert...",t.style.animation="spin 1s linear infinite",o.classList.add("refreshing")}(function(){u();return new Promise(e=>{window.location.reload(),e()})})().finally(()=>{setTimeout(()=>{if(a=!1,c(),o){o.classList.remove("refreshing");o.querySelector(".pull-to-refresh-spinner i").style.animation=""}},500)})}():c(),n=!1,e=0,t=0}function c(){o&&(o.style.transform="translateY(0)",o.style.opacity="0",o.classList.remove("ready"))}function u(){return new URLSearchParams(window.location.search).get("page")||"home"}function m(){if(!s())return;const e=u();"newsroom"!==e&&"events"!==e||(o=function(){const e=document.createElement("div");return e.id="pull-to-refresh-indicator",e.className="pull-to-refresh-indicator",e.innerHTML='\n            <div class="pull-to-refresh-content">\n                <div class="pull-to-refresh-spinner">\n                    <i class="fas fa-sync-alt"></i>\n                </div>\n                <div class="pull-to-refresh-text">Zum Aktualisieren ziehen</div>\n            </div>\n        ',e}(),document.body.insertBefore(o,document.body.firstChild),document.addEventListener("touchstart",r,{passive:!0}),document.addEventListener("touchmove",l,{passive:!1}),document.addEventListener("touchend",d,{passive:!0}),window.addEventListener("resize",function(){s()||(document.removeEventListener("touchstart",r),document.removeEventListener("touchmove",l),document.removeEventListener("touchend",d),o&&o.parentNode&&(o.parentNode.removeChild(o),o=null))}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m()}(),document.addEventListener("DOMContentLoaded",function(){initializeSearchInstances()});